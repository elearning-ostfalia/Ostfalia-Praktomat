{% extends "base.html" %}
{% load i18n %} {% load in_group %} {% load chunks %}
{% block extrahead %}{{ block.super }}
<script type="text/javascript">	
	window.onload = function() {
		var all_grades = new Array();
		var grades=new Array();
		$('.grade_cell').each(function(index) {
			grades[index] = $(this).text()
		});
		
		{% include "attestation/rating_scale_items_js_inline.html" with tasks=expired_tasks %}
		
		var result;
		try {
			{{script|safe}}
		} catch (e) {
		}

		if (result) {
			$("#calculated_grade_cell").text(result);
		} else {
			$("#predicted_final_grade").hide();
		}
		
	};	
	</script>
{% endblock %} 
{% block breadcrumbs %}<span class="icon icon-white ui-icon-home"></span>Home{% endblock %}
{% block content %}<div id='task_list'>

<div id="welcome">

	{% chunk "Welcome Message" %}
	
	{% if not user|in_group:"Trainer" and not user.is_superuser %}
		{% if tutors or trainers %}
			<div id="contact"><a> {% trans "Got Problems?"%} </a>
			{% if tutors %}
				<a> {% trans "Your tutor"%}{{tutors.count|pluralize}}: </a>
				{% for tutor in tutors %}
					<a href="mailto:{{tutor.email}}">{{tutor.get_full_name}}</a>	
				{% endfor %}
			{% endif %}
			{% if trainers %}
				<a> {% trans "Your trainer"%}{{trainers.count|pluralize}}: </a>
				{% for trainer in trainers %}
					<a href="mailto:{{trainer.email}}">{{trainer.get_full_name}}</a>	
				{% endfor %}
			{% endif %}</div>
		{% endif %}
	{% endif %}
</div>

{% regroup tasks by expired as grouped_tasks %}

<div>{% for group in grouped_tasks %}
    <div id="{% if group.grouper %}expired_tasks{% else %}upcoming_tasks{% endif %}" class="{% if group.grouper %}right{% else %}left{% endif %}" >
		<h2>{% if group.grouper %}{% trans "Expired tasks" %}{% else %}{% trans "Upcoming tasks" %}{% endif %}</h2>
		{% for task in group.list%}
			<h3><a href={% url task_detail task_id=task.id%}>{{task.title}}</a></h3>
			{{ task.submission_date|date }} {{ task.submission_date|time }}
			{% if user|in_group:"User" %}
				<a href={% url solution_list task_id=task.id%}>{% trans "Solutions"%}</a>
			{% endif %}
			{% if user|in_group:"Tutor,Trainer"%}
				<a href={% url attestation_list task_id=task.id%}>{% trans "Attestation"%}</a>
				<a href={% url statistics task_id=task.id%}>{% trans "Statistics"%}</a>
			{% endif %} <br/><br/>
		{% endfor %}
	</div>
{% empty %}
	<a>{% trans "Nothing to do right now! Yay!" %}</a>
{% endfor %}</div>

{% if user|in_group:"User"%}	
	{% if attestations %}
		<div id="attestation_overview">
			<h2>{% trans "Result Overview"%}</h2>
			<table>
				<tr><th>{% trans "Task"%}</th><th>{% trans "Grade"%}</th><th>{% trans "Rating Scale"%}</th></tr>
				{% for task, attestation in attestations%}
					<tr>
						<td>{{task}}</td>
						<td class="grade_cell">{% if attestation %}
							<a href={% url view_attestation attestation_id=attestation.id%}>{{attestation.final_grade}} </a>
							{%else%}-{%endif%}</td>
						<td>{{task.final_grade_rating_scale.name}}</td>
					</tr>
				{% endfor %}
				
				{% if show_final_grade %}
					<tr class="final_grade"><td>{% trans "Final Grade"%}</td><td>{{user.final_grade}}</td></tr>
				{% else %}
					<tr class="final_grade" id="predicted_final_grade"><td>{% trans "Predicted Final Grade"%}</td><td id="calculated_grade_cell"></td></tr>
				{% endif %}
				
			</table>
		</div>
	{% endif %}
{% endif %}


</div>{% endblock %}
